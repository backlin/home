# Load CRAN packages
pkg <- c("devtools", "xtermStyle", "dataview",
         #"data.table",
         "magrittr", "tidyr", "dplyr")
pkg.installed <- rownames(installed.packages())
pkg.missing <- setdiff(pkg, pkg.installed)
pkg <- intersect(pkg, pkg.installed)
for(p in pkg){
    require(p, character.only=TRUE)
}
if(length(pkg.missing) > 0){
    cat("Could not load some of Christofer's start-up package(s), ", 
        "type the following to install them and restart R:\n",
        "   install.packages(",
        paste('"', pkg.missing, '"', sep="", collapse=", "),
        ")\n", sep="")
}

# dataview
if("package:dataview" %in% search()){
    ev <- function(...) entry.view(...)
    hv <- heat.view
    if(!grepl("RStudio", session_info()$platform$ui)){
        print.factor <- heat.view
    }

    # Save this for the whos-masking below
    if(!exists("startup.objs"))
        startup.objs <- c(ls(all.names=TRUE), "startup.objs")
    # Keep in workspace to be saved and loaded together with in
    whos.exclude(startup.objs)

    if("package:data.table" %in% search()){
        opt <- default.options()
        opt$columns$Key <- NULL
        opt$columns$keyed <- haskey
        opt$print$comment <- function(x) ifelse(x, "+!", "")
        opt$print$keyed <- function(x) ifelse(x, "╥─o", "")
        options(dataview = opt)
    }
}

# Vim integration
if("vimcom" %in% pkg.installed){
    require("vimcom")
    options(vimcom.verbose = 1)
} else {
    cat("Vim integration not installed, see http://www.lepem.ufc.br/jaa/vimcom.html for instructions.\n")
}

# My miscellaneous functions
if("Bmisc" %in% pkg.installed){
    require("Bmisc")
} else {
    cat("The `Bmisc` package is not installed (and not available on CRAN).\n")
}

rm(p, pkg, pkg.installed, pkg.missing)
